
{% extends 'base.html' %}
{% block style %}

<script src="{{ url_for('static', filename='sortablejs/Sortable.min.js') }}"></script>
<style>
    .list-group.col {
        min-height: 50px;
        padding: 5px;
        background-color: #f8f9fa;
        border-radius: 5px;
    }
</style>
{% endblock %}

{% block title%}
Sortable Test
{% endblock %}
{% block content %}
<div class="container">
    <span><h1>Column Setup for Tables across MCRIT</h1></span>
    <!-- start modifications here -->
    <span><h3>Family Table</h3></span>
    <div class="row" style="display: flex; justify-content: space-between;">
        <div class="col"><strong>Active</strong></div>
        <div class="col"><strong>Available</strong></div>
    </div>
    <div id="items" class="row" style="display: flex; justify-content: space-between;">
        <div id="family_table_active" class="list-group col">
            {% for item in user_column_settings.family_table.active %}
            <div class="list-group-item">{{ item }}</div>
            {% endfor %}
        </div>
        <div id="family_table_available" class="list-group col">
            {% for item in user_column_settings.family_table.available %}
            <div class="list-group-item">{{ item }}</div>
            {% endfor %}
        </div>
    </div>

    <span><h3>Samples Table</h3></span>
    <div class="row" style="display: flex; justify-content: space-between;">
        <div class="col"><strong>Active</strong></div>
        <div class="col"><strong>Available</strong></div>
    </div>
    <div id="items" class="row" style="display: flex; justify-content: space-between;">
        <div id="samples_table_active" class="list-group col">
            {% for item in user_column_settings.samples_table.active %}
            <div class="list-group-item">{{ item }}</div>
            {% endfor %}
        </div>
        <div id="samples_table_available" class="list-group col">
            {% for item in user_column_settings.samples_table.available %}
            <div class="list-group-item">{{ item }}</div>
            {% endfor %}
        </div>
    </div>

    <span><h3>Functions Table</h3></span>
    <div class="row" style="display: flex; justify-content: space-between;">
        <div class="col"><strong>Active</strong></div>
        <div class="col"><strong>Available</strong></div>
    </div>
    <div id="items" class="row" style="display: flex; justify-content: space-between;">
        <div id="functions_table_active" class="list-group col">
            {% for item in user_column_settings.functions_table.active %}
            <div class="list-group-item">{{ item }}</div>
            {% endfor %}
        </div>
        <div id="functions_table_available" class="list-group col">
            {% for item in user_column_settings.functions_table.available %}
            <div class="list-group-item">{{ item }}</div>
            {% endfor %}
        </div>
    </div>

    <span><h3>Result Family Table</h3></span>
    <div class="row" style="display: flex; justify-content: space-between;">
        <div class="col"><strong>Active</strong></div>
        <div class="col"><strong>Available</strong></div>
    </div>
    <div id="items" class="row" style="display: flex; justify-content: space-between;">
        <div id="result_family_table_active" class="list-group col">
            {% for item in user_column_settings.result_family_table.active %}
            <div class="list-group-item">{{ item }}</div>
            {% endfor %}
        </div>
        <div id="result_family_table_available" class="list-group col">
            {% for item in user_column_settings.result_family_table.available %}
            <div class="list-group-item">{{ item }}</div>
            {% endfor %}
        </div>
    </div>

    <span><h3>Result Function Unfiltered Table</h3></span>
    <div class="row" style="display: flex; justify-content: space-between;">
        <div class="col"><strong>Active</strong></div>
        <div class="col"><strong>Available</strong></div>
    </div>
    <div id="items" class="row" style="display: flex; justify-content: space-between;">
        <div id="result_function_unfiltered_table_active" class="list-group col">
            {% for item in user_column_settings.result_function_unfiltered_table.active %}
            <div class="list-group-item">{{ item }}</div>
            {% endfor %}
        </div>
        <div id="result_function_unfiltered_table_available" class="list-group col">
            {% for item in user_column_settings.result_function_unfiltered_table.available %}
            <div class="list-group-item">{{ item }}</div>
            {% endfor %}
        </div>
    </div>

    <span><h3>Result Function Sample Filtered Table</h3></span>
    <div class="row" style="display: flex; justify-content: space-between;">
        <div class="col"><strong>Active</strong></div>
        <div class="col"><strong>Available</strong></div>
    </div>
    <div id="items" class="row" style="display: flex; justify-content: space-between;">
        <div id="result_function_sample_filtered_table_active" class="list-group col">
            {% for item in user_column_settings.result_function_sample_filtered_table.active %}
            <div class="list-group-item">{{ item }}</div>
            {% endfor %}
        </div>
        <div id="result_function_sample_filtered_table_available" class="list-group col">
            {% for item in user_column_settings.result_function_sample_filtered_table.available %}
            <div class="list-group-item">{{ item }}</div>
            {% endfor %}
        </div>
    </div>

    <span><h3>Result Function Function Filtered Table</h3></span>
    <div class="row" style="display: flex; justify-content: space-between;">
        <div class="col"><strong>Active</strong></div>
        <div class="col"><strong>Available</strong></div>
    </div>
    <div id="items" class="row" style="display: flex; justify-content: space-between;">
        <div id="result_function_function_filtered_table_active" class="list-group col">
            {% for item in user_column_settings.result_function_function_filtered_table.active %}
            <div class="list-group-item">{{ item }}</div>
            {% endfor %}
        </div>
        <div id="result_function_function_filtered_table_available" class="list-group col">
            {% for item in user_column_settings.result_function_function_filtered_table.available %}
            <div class="list-group-item">{{ item }}</div>
            {% endfor %}
        </div>
    </div>

    <div class="text-center mt-4 mb-4">
        <button id="saveButton" class="btn btn-primary btn-lg" onclick="saveColumnSettings()">Save Column Settings</button>
    </div>

    <script type="text/javascript">
        // Family Table
        var familyTableActive = document.getElementById('family_table_active');
        var familyTableAvailable = document.getElementById('family_table_available');
        new Sortable(familyTableActive, {group: 'family_table_group', animation: 100});
        new Sortable(familyTableAvailable, {group: 'family_table_group', animation: 100});

        // Samples Table
        var samplesTableActive = document.getElementById('samples_table_active');
        var samplesTableAvailable = document.getElementById('samples_table_available');
        new Sortable(samplesTableActive, {group: 'samples_table_group', animation: 100});
        new Sortable(samplesTableAvailable, {group: 'samples_table_group', animation: 100});

        // Functions Table
        var functionsTableActive = document.getElementById('functions_table_active');
        var functionsTableAvailable = document.getElementById('functions_table_available');
        new Sortable(functionsTableActive, {group: 'functions_table_group', animation: 100});
        new Sortable(functionsTableAvailable, {group: 'functions_table_group', animation: 100});

        // Result Family Table
        var resultFamilyTableActive = document.getElementById('result_family_table_active');
        var resultFamilyTableAvailable = document.getElementById('result_family_table_available');
        new Sortable(resultFamilyTableActive, {group: 'result_family_table_group', animation: 100});
        new Sortable(resultFamilyTableAvailable, {group: 'result_family_table_group', animation: 100});

        // Result Function Unfiltered Table
        var resultFunctionUnfilteredTableActive = document.getElementById('result_function_unfiltered_table_active');
        var resultFunctionUnfilteredTableAvailable = document.getElementById('result_function_unfiltered_table_available');
        new Sortable(resultFunctionUnfilteredTableActive, {group: 'result_function_unfiltered_table_group', animation: 100});
        new Sortable(resultFunctionUnfilteredTableAvailable, {group: 'result_function_unfiltered_table_group', animation: 100});

        // Result Function Sample Filtered Table
        var resultFunctionSampleFilteredTableActive = document.getElementById('result_function_sample_filtered_table_active');
        var resultFunctionSampleFilteredTableAvailable = document.getElementById('result_function_sample_filtered_table_available');
        new Sortable(resultFunctionSampleFilteredTableActive, {group: 'result_function_sample_filtered_table_group', animation: 100});
        new Sortable(resultFunctionSampleFilteredTableAvailable, {group: 'result_function_sample_filtered_table_group', animation: 100});

        // Result Function Function Filtered Table
        var resultFunctionFunctionFilteredTableActive = document.getElementById('result_function_function_filtered_table_active');
        var resultFunctionFunctionFilteredTableAvailable = document.getElementById('result_function_function_filtered_table_available');
        new Sortable(resultFunctionFunctionFilteredTableActive, {group: 'result_function_function_filtered_table_group', animation: 100});
        new Sortable(resultFunctionFunctionFilteredTableAvailable, {group: 'result_function_function_filtered_table_group', animation: 100});

        function getElementsFromContainer(containerId) {
            const container = document.getElementById(containerId);
            const items = container.querySelectorAll('.list-group-item');
            return Array.from(items).map(item => item.textContent.trim());
        }

        function saveColumnSettings() {
            const columnSettings = {
                family_table: {
                    active: getElementsFromContainer('family_table_active'),
                    available: getElementsFromContainer('family_table_available')
                },
                samples_table: {
                    active: getElementsFromContainer('samples_table_active'),
                    available: getElementsFromContainer('samples_table_available')
                },
                functions_table: {
                    active: getElementsFromContainer('functions_table_active'),
                    available: getElementsFromContainer('functions_table_available')
                },
                result_family_table: {
                    active: getElementsFromContainer('result_family_table_active'),
                    available: getElementsFromContainer('result_family_table_available')
                },
                result_function_unfiltered_table: {
                    active: getElementsFromContainer('result_function_unfiltered_table_active'),
                    available: getElementsFromContainer('result_function_unfiltered_table_available')
                },
                result_function_sample_filtered_table: {
                    active: getElementsFromContainer('result_function_sample_filtered_table_active'),
                    available: getElementsFromContainer('result_function_sample_filtered_table_available')
                },
                result_function_function_filtered_table: {
                    active: getElementsFromContainer('result_function_function_filtered_table_active'),
                    available: getElementsFromContainer('result_function_function_filtered_table_available')
                }
            };

            // Send POST request
            fetch("{{ url_for('admin.change_column_settings') }}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    column_settings: columnSettings
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Column settings saved successfully!');
                } else {
                    alert('Error saving column settings: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error saving column settings: ' + error.message);
            });
        }
    </script>
    <!-- end modifications here -->
{% endblock %}